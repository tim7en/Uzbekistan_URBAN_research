Navoiy,2024,107.2981902110347,319.78186071241237,1404669.5843137254,35.27603470384733,304.1673791054876,b1,107298190.2110347,1.4206769351587667,1.341811770226431,0.4670707750899368,10.851713182004545,11.251539212508721
Termez,2017,55.32829067909426,201.3446209483334,696241.0980392155,28.567553308008677,193.6752863731716,b1,55328290.67909426,,,,0.0,0.0
Termez,2018,58.078527871320986,218.03553994639833,730849.5058823529,29.987578156676047,193.6752863731716,b1,58078527.871320985,2.7502371922267272,4.970761175649163,1.4200248486673708,2.7502371922267272,4.970761175649163
Termez,2019,61.278041217607985,234.1389984648568,771099.3450980393,31.63957692544111,193.6752863731716,b1,61278041.21760798,3.1995133462869987,5.508943603694383,1.6519987687650612,5.949750538513726,10.753541209184391
Termez,2020,61.27637667219279,232.8871246897184,771078.568627451,31.638717473806178,193.6752863731716,b1,61276376.67219279,-0.0016645454151955619,-0.0027163815652708756,-0.0008594516349305081,5.94808599309853,10.75053272040809
Termez,2021,60.791508081612164,233.25593049126215,764984.1607843137,31.388366177231152,193.6752863731716,b1,60791508.08161216,-0.4848685905806249,-0.7912814316265782,-0.2503512965750261,5.463217402517905,9.874184319563973
Termez,2022,59.59226487889084,232.3808877258045,749895.9098039216,30.76916316729697,193.6752863731716,b1,59592264.878890835,-1.199243202721327,-1.972715006693615,-0.6192030099341821,4.2639741997965785,7.706679797009741
Termez,2023,61.33225854714227,236.01709970611012,771782.5803921568,31.667570858249768,193.6752863731716,b1,61332258.54714227,1.7399936682514294,2.919831410649709,0.8984076909527978,6.003967868048008,10.85153326509074
Termez,2024,62.322545097705515,247.64575576356089,784247.325490196,32.17888366904132,193.6752863731716,b1,62322545.09770551,0.9902865505632477,1.6146259309888,0.5113128107915514,6.994254418611256,12.641370866087541
Gulistan,2017,62.6324731121554,339.90793939814574,824497.6078431371,32.33890822367131,193.6752863731804,b1,62632473.1121554,,,,0.0,0.0
Gulistan,2018,64.28771893038663,351.8777458932324,846282.1764705882,33.19355821501912,193.6752863731804,b1,64287718.93038663,1.6552458182312293,2.642791727650917,0.8546499913478058,1.6552458182312293,2.642791727650917
Gulistan,2019,65.76801430739272,361.57450592231874,865766.6705882351,33.95787637079755,193.6752863731804,b1,65768014.30739272,1.4802953770060867,2.3026098944481266,0.7643181557784331,3.135541195237316,5.0062548059095935
Gulistan,2020,67.05769010522272,369.46389245299184,882742.7607843137,34.623772274183494,193.6752863731804,b1,67057690.105222724,1.2896757978300002,1.9609468392981944,0.6658959033859446,4.425216993067316,7.065371640591489
Gulistan,2021,67.8072093941964,370.91106863772177,892605.537254902,35.01077017309429,193.6752863731804,b1,67807209.3941964,0.749519288973687,1.11772309454381,0.38699789891079917,5.174736282041003,8.262066025677516
Gulistan,2022,69.16850490268757,382.0515968948831,910522.8470588233,35.713645348333834,193.6752863731804,b1,69168504.90268758,1.3612955084911675,2.007597010190021,0.7028751752395408,6.536031790532171,10.435532026378969
Gulistan,2023,68.7871545306522,377.89506013463927,905503.0980392154,35.51674342079488,193.6752863731804,b1,68787154.5306522,-0.3813503720353708,-0.5513352826866602,-0.19690192753895275,6.1546814184968,9.826661973694817
Gulistan,2024,70.27325564649239,393.13344579369254,925062.3098039215,36.28405924289555,193.6752863731804,b1,70273255.64649239,1.4861011158401851,2.1604340606616645,0.7673158221006702,7.640782534336985,12.19939458666226
Nurafshon,2017,46.32551550283942,694.2581945422353,614621.1450980391,23.91916716394093,193.67528637316826,b1,46325515.50283942,,,,0.0,0.0
Nurafshon,2018,47.16962238886262,712.0687172079053,625819.6470588234,24.355003300719265,193.67528637316826,b1,47169622.38886262,0.8441068860231979,1.8221208698076197,0.43583613677833455,0.8441068860231979,1.8221208698076197
Nurafshon,2019,48.15368922291314,729.4167118790581,638873.5137254901,24.863104696864585,193.67528637316826,b1,48153689.22291314,0.9840668340505161,2.0862300442813453,0.5081013961453209,1.828173720073714,3.9463645471180087
Nurafshon,2020,49.47480281419112,749.8491853869864,656398.8901960783,25.545232817606074,193.67528637316826,b1,49474802.814191125,1.3211135912779852,2.7435355682973395,0.6821281207414884,3.1492873113516993,6.798170030420203
Nurafshon,2021,49.735545173147806,750.3376326487219,659859.6470588234,25.679861434317807,193.67528637316826,b1,49735545.173147805,0.2607423589566835,0.5270205117055893,0.13462861671173343,3.4100296703083828,7.361018292606736
Nurafshon,2022,51.663195108277094,771.7297263807205,685428.1921568627,26.675161336141702,193.67528637316826,b1,51663195.1082771,1.9276499351292884,3.875799347163933,0.9952999018238948,5.337679605437671,11.52211593870016
Nurafshon,2023,51.10315227678867,769.9968613834068,678002.3058823529,26.385995463729177,193.67528637316826,b1,51103152.27678867,-0.560042831488424,-1.0840267047260044,-0.289165872412525,4.777636773949247,10.313186420249142
Nurafshon,2024,52.550409892997926,786.1467343569205,697197.9450980391,27.133255293989976,193.67528637316826,b1,52550409.89299793,1.4472576162092565,2.8320319818443185,0.7472598302607985,6.224894390158504,13.43729113986214
Fergana,2017,159.29868456910205,854.6471555814503,2094194.4156862746,36.24610000362189,439.4919303130106,b1,159298684.56910205,,,,0.0,0.0
Fergana,2018,167.75446242084467,887.2122613891268,2205327.9333333336,38.17008933505747,439.4919303130106,b1,167754462.42084467,8.455777851742624,5.3081278571855295,1.9239893314355783,8.455777851742624,5.3081278571855295
Fergana,2019,172.7072612139231,912.8312922614327,2270422.443137255,39.297026703293334,439.4919303130106,b1,172707261.2139231,4.952798793078415,2.952409564315106,1.1269373682358648,13.40857664482104,8.417255096042275
Fergana,2020,173.2154347991531,916.1838978279194,2277101.2745098043,39.412654215468145,439.4919303130106,b1,173215434.7991531,0.5081735852299971,0.29423984936021164,0.11562751217481093,13.916750230051036,8.736261864117335
Fergana,2021,174.93882876345177,926.7483065189667,2299752.5490196077,39.8047874596602,439.4919303130106,b1,174938828.76345176,1.7233939642986797,0.994942492449935,0.39213324419205264,15.640144194349716,9.81812513810507
Fergana,2022,182.00934329048061,951.5126862272284,2392708.3568627452,41.41358025865269,439.4919303130106,b1,182009343.2904806,7.070514527028848,4.0417067937441375,1.6087927989924964,22.710658721378564,14.25665176257429
Fergana,2023,179.4107536352198,928.446344070519,2358541.6078431373,40.822308957400345,439.4919303130106,b1,179410753.6352198,-2.5985896552608096,-1.4277232191940548,-0.5912713012523483,20.112069066117755,12.625383015886339
Fergana,2024,180.36249194125273,952.3582428302121,2371076.4980392163,41.03886317384639,439.4919303130106,b1,180362491.94125274,0.9517383060329223,0.53048007811618,0.2165542164460419,21.063807372150677,13.22283823568764
Urgench,2017,104.71819649776673,821.6101831669836,1400502.3098039213,34.42781957937965,304.1673791054926,b1,104718196.49776673,,,,0.0,0.0
Urgench,2018,106.50638847937671,832.473404224556,1424417.9999999995,35.01571693604846,304.1673791054926,b1,106506388.4793767,1.7881919816099838,1.7076229742441384,0.5878973566688117,1.7881919816099838,1.7076229742441384
Urgench,2019,107.94448707589835,844.2039155914922,1443645.372549019,35.48851536721343,304.1673791054793,b1,107944487.07589835,1.438098596521641,1.3502463251771069,0.4727984311649678,3.226290578131625,3.0809264158788485
Urgench,2020,109.09287621329148,857.9801005476107,1459000.4745098033,35.86606707600141,304.1673791054926,b1,109092876.21329148,1.1483891373931243,1.0638701137054563,0.3775517087879763,4.374679715524749,4.177573584948102
Urgench,2021,108.57954026796567,855.2849920268013,1452137.5137254896,35.69729948927483,304.1673791054926,b1,108579540.26796567,-0.5133359453258066,-0.47054946495512784,-0.16876758672657388,3.8613437701989426,3.6873665698408997
Urgench,2022,111.65580303475924,886.0609341111881,1493279.1568627444,36.70867118069039,304.1673791054926,b1,111655803.03475924,3.076262766793576,2.833188240806339,1.0113716914155546,6.937606536992519,6.625024846699379
Urgench,2023,113.32968390763988,898.8949341754378,1515671.1019607838,37.25898689100858,304.1673791054926,b1,113329683.90763988,1.6738808728806305,1.4991436426815552,0.5503157103181948,8.611487409873149,8.223487128196293
Urgench,2024,114.80247049742177,904.8574531300939,1535373.0196078424,37.74318956721704,304.1673791054926,b1,114802470.49742177,1.4727865897818901,1.2995594260919008,0.48420267620845436,10.08427399965504,9.629915656416133
"
# ---- Read data ----
# If reading from a file instead: df <- readr::read_csv("your_file.csv")
df <- readr::read_csv(csv_text, show_col_types = FALSE) |>
janitor::clean_names()
# Coerce numeric columns (some have blanks)
num_cols <- c("built_area_core_km2","built_area_extended_km2","built_pixels",
"urban_density_pct","analysis_area_km2","debug_area_m2",
"annual_growth_km2","annual_growth_pct","density_change_pct",
"cumulative_growth_km2","cumulative_growth_pct","year")
df <- df |>
mutate(across(all_of(num_cols), ~ suppressWarnings(as.numeric(.x))))
# ---- Basic checks & derived fields ----
df <- df |>
group_by(city) |>
arrange(year, .by_group = TRUE) |>
mutate(
# If annual growth is missing in first year, compute from difference where possible
annual_growth_km2_calc = built_area_core_km2 - lag(built_area_core_km2),
annual_growth_km2_f = coalesce(annual_growth_km2, annual_growth_km2_calc, 0),
yoy_pct_calc = (built_area_core_km2/lag(built_area_core_km2) - 1) * 100,
annual_growth_pct_f = coalesce(annual_growth_pct, yoy_pct_calc),
density_change_pct_f = coalesce(density_change_pct,
urban_density_pct - lag(urban_density_pct)),
cum_growth_km2_calc = cumsum(replace_na(annual_growth_km2_f, 0)),
cum_growth_km2_f = coalesce(cumulative_growth_km2, cum_growth_km2_calc),
cum_growth_pct_f = coalesce(cumulative_growth_pct,
cum_growth_km2_f / first(built_area_core_km2) * 100)
) |>
ungroup()
# ---- City-level summary (first/last, CAGR, ranks) ----
city_summary <- df |>
group_by(city) |>
summarise(
start_year = min(year, na.rm = TRUE),
end_year   = max(year, na.rm = TRUE),
n_years    = end_year - start_year,
core_start = built_area_core_km2[year == start_year][1],
core_end   = built_area_core_km2[year == end_year][1],
ext_start  = built_area_extended_km2[year == start_year][1],
ext_end    = built_area_extended_km2[year == end_year][1],
dens_start = urban_density_pct[year == start_year][1],
dens_end   = urban_density_pct[year == end_year][1],
delta_core_km2 = core_end - core_start,
delta_ext_km2  = ext_end - ext_start,
delta_dens_pct = dens_end - dens_start,
CAGR_core = ifelse(n_years > 0 & core_start > 0,
(core_end / core_start)^(1/n_years) - 1, NA_real_),
CAGR_ext  = ifelse(n_years > 0 & ext_start  > 0,
(ext_end  / ext_start )^(1/n_years) - 1, NA_real_)
) |>
mutate(
rank_delta_core = dense_rank(desc(delta_core_km2)),
rank_cagr_core  = dense_rank(desc(CAGR_core))
) |>
arrange(rank_delta_core)
readr::write_csv(city_summary, file.path(out_dir, "city_summary_2017_2024.csv"))
# ---- Anomaly flags ----
anomalies <- df |>
mutate(
flag_neg_growth = annual_growth_km2_f < 0,
flag_density_drop_gt1 = density_change_pct_f < -1,
flag_missing_any = if_any(everything(), ~ is.na(.x))
) |>
filter(flag_neg_growth | flag_density_drop_gt1 | flag_missing_any)
readr::write_csv(anomalies, file.path(out_dir, "anomalies.csv"))
# ---- Correlations (wide numeric) ----
num_mat <- df |>
select(where(is.numeric)) |>
select(-year) |> # keep year out of corr
drop_na()
if (nrow(num_mat) > 2) {
corr_m <- cor(num_mat, use = "pairwise.complete.obs")
png(file.path(out_dir, "correlation_matrix.png"), width = 1400, height = 1200, res = 150)
corrplot::corrplot(corr_m, method = "color", tl.cex = 0.7, number.cex = 0.6, addCoef.col = NA)
dev.off()
}
# ---- Helper for saving ggplots ----
save_plot <- function(p, filename, w = 10, h = 6) {
ggsave(file.path(out_dir, filename), p, width = w, height = h, dpi = 150)
}
theme_set(
theme_minimal(base_size = 12) +
theme(
plot.title = element_text(face = "bold", size = 14),
plot.subtitle = element_text(color = "grey30"),
plot.caption = element_text(size = 9, color = "grey40"),
panel.grid.minor = element_blank()
)
)
# ---- 1) Core built-up area over time (faceted) ----
p1 <- df |>
ggplot(aes(year, built_area_core_km2, group = city)) +
geom_line() +
geom_point(size = 1.7) +
facet_wrap(~ fct_reorder(city, built_area_core_km2, .fun = max, .desc = TRUE), scales = "free_y") +
labs(
title = "Built-up Area (Core) Over Time",
y = "Built Area (km²)", x = NULL,
caption = "Source: SUHI/urban classification outputs (2017–2024)"
)
save_plot(p1, "01_core_built_area_timeseries.png", w = 12, h = 9)
# ---- 2) Annual growth % heatmap ----
p2 <- df |>
mutate(year = factor(year)) |>
ggplot(aes(year, fct_reorder(city, cumulative_growth_km2_f, .fun = max, .desc = TRUE), fill = annual_growth_pct_f)) +
geom_tile(color = "white", linewidth = 0.2) +
scale_fill_viridis_c(labels = label_percent(scale = 1), na.value = "grey90") +
labs(
title = "Annual Growth Rate of Built-up Area — Heatmap",
x = NULL, y = NULL, fill = "YoY growth",
caption = "White borders help read across years. NA shown in light grey."
)
save_plot(p2, "02_growth_pct_heatmap.png", w = 10, h = 6.5)
# ============================================================
# Urban Expansion & Density Analysis — Uzbekistan Cities (2017–2024)
# ============================================================
# ---- Packages ----
required <- c(
"tidyverse", "readr", "janitor", "lubridate", "scales", "glue", "forcats", "patchwork", "ggtext", "corrplot"
)
to_install <- setdiff(required, rownames(installed.packages()))
if (length(to_install)) install.packages(to_install, quiet = TRUE)
invisible(lapply(required, library, character.only = TRUE))
# ---- Output dir ----
out_dir <- file.path(getwd(), "outputs")
if (!dir.exists(out_dir)) dir.create(out_dir, recursive = TRUE)
# ---- Data (inline CSV) ----
csv_text <- "
city,year,Built_Area_core_km2,Built_Area_extended_km2,built_pixels,urban_density_pct,analysis_area_km2,area_key_used,debug_area_m2,annual_growth_km2,annual_growth_pct,density_change_pct,cumulative_growth_km2,cumulative_growth_pct
Tashkent,2017,496.8286777958511,1169.0838832315144,6619388.929411765,72.10451833095885,689.0395904392753,b1,496828677.7958511,,,,0.0,0.0
Tashkent,2018,504.54123749786527,1194.19736647762,6722087.666666666,73.22383858614148,689.0395904392753,b1,504541237.49786526,7.712559702014175,1.5523579951605138,1.119320255182629,7.712559702014175,1.5523579951605138
Tashkent,2019,512.7362445381287,1213.3674387563672,6831207.188235295,74.41317620243709,689.0395904392753,b1,512736244.5381288,8.195007040263476,1.6242492052590984,1.189337616295603,15.907566742277652,3.201821362818791
Tashkent,2020,521.3949039091481,1245.4926527758648,6946502.337254902,75.6698034690217,689.0395904392706,b1,521394903.90914804,8.658659371019326,1.688716072494345,1.2566272665846157,24.566226113296977,4.944607107279619
Tashkent,2021,524.370017334624,1247.630175112493,6986097.513725491,76.10158031707996,689.0395904392753,b1,524370017.33462393,2.975113425475911,0.5706065408714212,0.4317768480582629,27.54133953877289,5.543427899725573
Tashkent,2022,529.0804021047669,1271.689501204162,7048829.556862745,76.7851963001819,689.0395904392753,b1,529080402.1047669,4.710384770142923,0.8982940699176156,0.6836159831019302,32.25172430891581,6.4915182537365945
Tashkent,2023,530.1183463809383,1265.586805139545,7062628.800000001,76.93583267733254,689.0395904392753,b1,530118346.3809383,1.0379442761714017,0.19617893084724614,0.15063637715064715,33.28966858508721,6.700432175689763
Tashkent,2024,532.6486632046896,1282.6681081598206,7096330.137254903,77.30305639841629,689.0395904392753,b1,532648663.2046896,2.5303168237512637,0.4773116872912375,0.36722372108374657,35.81998540883848,7.209725808854595
Nukus,2017,96.76364565325188,445.27681479513797,1312512.650980392,31.812630906648014,304.16737910548227,b1,96763645.65325189,,,,0.0,0.0
Nukus,2018,98.93412896084003,453.98909328879125,1341965.725490196,32.5262127884301,304.16737910548227,b1,98934128.96084003,2.1704833075881425,2.2430772351901274,0.7135818817820869,2.1704833075881425,2.2430772351901274
Nukus,2019,100.31289071970262,454.0626663085688,1360672.5098039214,32.97950326386417,304.16737910548227,b1,100312890.71970262,1.3787617588625949,1.393615907214718,0.4532904754340663,3.5492450664507373,3.6679530235655733
Nukus,2020,100.3533875411005,446.4235429427355,1361219.1647058823,32.99281725615255,304.16737910548227,b1,100353387.5411005,0.04049682139788047,0.04037050583163282,0.013313992288381371,3.589741887848618,3.7098043005864945
Nukus,2021,100.47283068626506,416.93662508758536,1362838.6235294119,33.03208614340661,304.16737910548227,b1,100472830.68626505,0.11944314516455279,0.11902253435702725,0.0392688872540603,3.7091850330131706,3.8332423380417646
Nukus,2022,103.97872041840151,485.811649673776,1410405.1294117647,34.18470472546719,304.16737910548227,b1,103978720.41840151,3.5058897321364526,3.489390821568361,1.1526185820605832,7.215074765149623,7.456389965922239
Nukus,2023,103.05797548197641,456.5070606299362,1397911.6549019609,33.881994770463834,304.16737910548227,b1,103057975.48197642,-0.9207449364250948,-0.8855128556305547,-0.3027099550033583,6.294329828724528,6.504849818577507
Nukus,2024,105.14682523546966,470.9096186826062,1426239.6156862744,34.56873828636495,304.16737910548227,b1,105146825.23546967,2.0888497534932498,2.0268686083966037,0.6867435159011137,8.383179582217778,8.66356318597019
Andijan,2017,187.13250182227077,1054.0124715830566,2473665.364705883,42.579280508971266,439.4919303130141,b1,187132501.82227078,,,,0.0,0.0
Andijan,2018,190.03458012160127,1073.3588492365323,2512011.835294118,43.23960623947184,439.4919303130141,b1,190034580.12160125,2.9020782993304977,1.5508146746665785,0.6603257305005741,2.9020782993304977,1.5508146746665785
Andijan,2019,192.70913152659222,1083.8439555825055,2547364.4941176474,43.8481615326455,439.4919303130141,b1,192709131.52659222,2.6745514049909502,1.4074024860525558,0.6085552931736586,5.576629704321448,2.980043365004459
Andijan,2020,194.70619596830034,1101.588048562472,2573757.6588235297,44.30256451571865,439.4919303130141,b1,194706195.96830034,1.997064441708119,1.0363102287306747,0.45440298307315174,7.573694146029567,4.047236087947281
Andijan,2021,197.04793477247853,1112.4372942364741,2604703.4039215688,44.83539313955945,439.4919303130141,b1,197047934.77247852,2.341738804178192,1.2027037930315565,0.5328286238407998,9.915432950207759,5.298616142921531
Andijan,2022,200.0360890958532,1132.399121131358,2644201.9647058826,45.51530421807379,439.4919303130141,b1,200036089.0958532,2.988154323374687,1.516460614938664,0.679911078514337,12.903587273582446,6.8954281848043975
Andijan,2023,201.55675037873613,1136.0577951874159,2664289.9803921576,45.861308587664794,439.4919303130141,b1,201556750.37873614,1.5206612828829122,0.7601934679667854,0.34600436959100733,14.424248556465358,7.7080402474204
Andijan,2024,205.9846525865424,1154.9087573504703,2722803.949019608,46.86881336816274,439.4919303130141,b1,205984652.5865424,4.427902207806284,2.1968513579852855,1.0075047804979462,18.85215076427164,10.07422579225521
Bukhara,2017,126.1186248759983,546.8688434631655,1642886.3960784306,41.463560374848285,304.1673791054895,b1,126118624.87599829,,,,0.0,0.0
Bukhara,2018,127.06282600372472,552.215489006586,1655187.3568627445,41.77398193632643,304.1673791054895,b1,127062826.00372472,0.94420112772643,0.7486611344317939,0.3104215614781438,0.94420112772643,0.7486611344317939
Bukhara,2019,130.95168570069876,572.0860955951989,1705842.0039215682,43.05250815712321,304.1673791054895,b1,130951685.70069875,3.8888596969740377,3.0605802021592465,1.2785262207967847,4.833060824700468,3.8321547110527154
Bukhara,2020,131.61138540508122,575.8020994292865,1714431.8313725484,43.26939522315986,304.1673791054895,b1,131611385.40508123,0.6596997043824615,0.5037733579774217,0.21688706603664798,5.492760529082929,4.3552334435009055
Bukhara,2021,132.22294588127394,577.0405259323392,1722399.4392156857,43.47045573069776,304.1673791054861,b1,132222945.88127394,0.6115604761927216,0.4646714068926583,0.20106050753789617,6.104321005275651,4.840142374908951
Bukhara,2022,131.87146049428654,575.384693628707,1717824.1764705877,43.35489916180432,304.1673791054861,b1,131871460.49428654,-0.35148538698740595,-0.26582782938674443,-0.1155565688934388,5.752835618288245,4.561448100107746
Bukhara,2023,131.3162099645683,578.7957380959156,1710594.6117647048,43.17235147001941,304.1673791054895,b1,131316209.96456829,-0.5552505297182506,-0.42105435674787417,-0.1825476917849116,5.197585088569994,4.121187567403584
Bukhara,2024,132.60257445127343,588.0855601075472,1727349.6313725482,43.59526483123787,304.1673791054895,b1,132602574.45127343,1.2863644867051391,0.979593065511275,0.42291336121846257,6.483949575275133,5.141151500541841
Samarkand,2017,232.50686176443634,1067.4870171235154,3023720.160784314,52.9035565223772,439.49193031302224,b1,232506861.76443633,,,,0.0,0.0
Samarkand,2018,239.83220947061028,1087.9863754899964,3119006.584313725,54.57033290686202,439.49193031302224,b1,239832209.4706103,7.325347706173943,3.150594202073753,1.6667763844848196,7.325347706173943,3.150594202073753
Samarkand,2019,240.87331078238392,1094.8768151582995,3132563.031372549,54.80722037622584,439.4919303130166,b1,240873310.78238392,1.0411013117736445,0.43409570135375386,0.23688746936382188,8.366449017947588,3.598366497425798
Samarkand,2020,245.45968468787615,1118.3716369863985,3192208.1450980394,55.85078308788304,439.49193031302224,b1,245459684.68787614,4.5863739054922235,1.9040606410877015,1.043562711657195,12.952822923439811,5.57094221871306
Samarkand,2021,254.1300396944965,1145.8211666461607,3304962.364705883,57.82359633167685,439.49193031302224,b1,254130039.6944965,8.670355006620355,3.5322928967522538,1.9728132437938157,21.623177930060166,9.300017111739113
Samarkand,2022,258.07971410266833,1169.2414547349733,3356324.733333334,58.722287328200665,439.49193031302224,b1,258079714.10266832,3.9496744081718305,1.5541942278527676,0.8986909965238112,25.572852338231996,10.998751668731854
Samarkand,2023,257.3248746057556,1162.979489563351,3346506.0666666664,58.5505345735198,439.49193031302224,b1,257324874.6057556,-0.754839496912723,-0.2924830800968836,-0.17175275468086681,24.818012841319273,10.674099100982048
Samarkand,2024,263.6900537348517,1187.0607704795862,3429281.137254902,59.99883855593025,439.49193031302224,b1,263690053.7348517,6.365179129096077,2.473596514463705,1.4483039824104509,31.18319197041535,13.411729758758039
Namangan,2017,192.76588649806823,810.4537705724196,2556589.243137255,43.8610753013771,439.4919303130172,b1,192765886.4980682,,,,0.0,0.0
Namangan,2018,200.1766133826555,848.9770033896799,2654915.3098039217,45.547278476782196,439.4919303130172,b1,200176613.3826555,7.4107268845872625,3.8444182314703923,1.6862031754050975,7.4107268845872625,3.8444182314703923
Namangan,2019,207.6993455598693,878.4203919340589,2754731.1137254904,47.25896682834213,439.4919303130172,b1,207699345.5598693,7.522732177213811,3.758047481217708,1.7116883515599355,14.933459061801074,7.746940775203348
Namangan,2020,212.74612011580757,886.0113253006226,2821706.9333333336,48.407287015323455,439.4919303130172,b1,212746120.11580756,5.046774555938271,2.429846152059034,1.1483201869813229,19.980233617739344,10.365025669590967
Namangan,2021,217.76844864135646,901.6616916685169,2888358.482352942,49.55004486345319,439.4919303130172,b1,217768448.64135647,5.022328525548886,2.360714509301043,1.1427578481297331,25.00256214328823,12.9704288437668
Namangan,2022,220.01726048729893,914.3689376865789,2918194.678431373,50.06172930879461,439.4919303130172,b1,220017260.48729894,2.2488118459424697,1.0326619213998356,0.5116844453414231,27.2513739892307,14.1370314448785
Namangan,2023,221.11048220875026,919.2391957088789,2932698.133333334,50.31047601972346,439.4919303130172,b1,221110482.20875025,1.0932217214513287,0.4968799807024471,0.2487467109288488,28.34459571068203,14.704155504696148
Namangan,2024,228.419406679523,951.5907224138065,3029709.1490196083,51.97351553573167,439.4919303130172,b1,228419406.67952302,7.308924470772752,3.3055531324256204,1.6630395160082116,35.65352018145478,18.495762310004004
Jizzakh,2017,103.75279273605337,284.7564117423554,1358411.6196078432,53.570486291236584,193.6752863731721,b1,103752792.73605336,,,,0.0,0.0
Jizzakh,2018,106.04492241183597,293.87223223642894,1388418.4470588237,54.753977338909806,193.67528637317326,b1,106044922.41183597,2.292129675782604,2.20922214750765,1.1834910476732219,2.292129675782604,2.20922214750765
Jizzakh,2019,107.9314120723815,307.0272210169956,1413112.8666666667,55.72802503279609,193.67528637317326,b1,107931412.07238151,1.8864896605455357,1.778953313030085,0.9740476938862841,4.17861933632814,4.027476491123028
Jizzakh,2020,109.8946023058467,313.5296153525827,1438813.611764706,56.7416753906856,193.67528637317326,b1,109894602.3058467,1.9631902334651983,1.8189238848729472,1.0136503578895102,6.141809569793338,5.919657107850651
Jizzakh,2021,111.06187529163006,319.04790265050787,1454095.5764705883,57.344371278035375,193.6752863731721,b1,111061875.29163006,1.167272985783356,1.0621749943047432,0.6026958873497748,7.309082555576694,7.044709219703571
Jizzakh,2022,112.18995598126497,327.4831940748019,1468860.0235294118,57.92683108008811,193.67528637317326,b1,112189955.98126498,1.1280806896349134,1.015722710131417,0.5824598020527318,8.437163245211607,8.13198664124224
Jizzakh,2023,112.31770773538204,326.7272995178278,1470528.9803921569,57.992792905424416,193.67528637317326,b1,112317707.73538205,0.12775175411707096,0.11387093701900053,0.06596182533630923,8.564914999328678,8.255117547647872
Jizzakh,2024,114.84328093471431,336.77715722513875,1503587.3333333335,59.29681741295296,193.67528637317326,b1,114843280.93471432,2.525573199332271,2.2485975277223957,1.3040245075285455,11.09048819866095,10.689339444457268
Qarshi,2017,114.81633238115732,450.90331672374714,1476558.3294117649,59.28290311647177,193.67528637317287,b1,114816332.38115732,,,,0.0,0.0
Qarshi,2018,119.878444737368,471.63603013183183,1541667.8980392157,61.89661416397063,193.67528637317287,b1,119878444.737368,5.062112356210676,4.408878293905016,2.6137110474988603,5.062112356210676,4.408878293905016
Qarshi,2019,120.42360161907614,475.24916733710336,1548678.407843137,62.17809400164994,193.67528637317287,b1,120423601.61907613,0.545156881708138,0.4547580533785567,0.2814798376793064,5.607269237918814,4.88368607638876
Qarshi,2020,122.42559902249715,485.0062899005903,1574428.4549019607,63.21178159334585,193.67528637317287,b1,122425599.02249715,2.001997403421015,1.6624626539187393,1.0336875916959087,7.609266641339829,6.627338187462084
Qarshi,2021,124.42062903948228,485.15566142363264,1600086.3215686274,64.24187172737622,193.67528637317287,b1,124420629.03948228,1.995030016985126,1.629585669103828,1.0300901340303739,9.604296658324955,8.364922009911835
Qarshi,2022,125.44073493506008,492.2909111392306,1613207.1921568625,64.7685811050571,193.67528637317287,b1,125440734.93506008,1.0201058955777995,0.8198848562757988,0.5267093776808736,10.624402553902755,9.253389594986183
Qarshi,2023,126.00256457564068,496.36807742290557,1620436.1607843137,65.05866955728172,193.67528637317145,b1,126002564.57564068,0.5618296405805978,0.44788452560602376,0.290088452224623,11.186232194483352,9.742718620682167
Qarshi,2024,126.69219864158902,502.7108913519917,1629308.6666666665,65.41474703049047,193.67528637317287,b1,126692198.64158902,0.68963406594834,0.5473174837916428,0.3560774732087566,11.875866260431692,10.343359706881428
Navoiy,2017,96.44647702903015,289.2493360022303,1262650.0941176468,31.708356534703476,304.1673791054844,b1,96446477.02903014,,,,0.0,0.0
Navoiy,2018,99.72135234481422,297.1198417595939,1305526.8588235294,32.785025349556,304.1673791054876,b1,99721352.34481423,3.2748753157840724,3.3955364847575886,1.0766688148525247,3.2748753157840724,3.3955364847575886
Navoiy,2019,101.87463052018389,303.4623481873103,1333701.7333333334,33.492950762761765,304.1673791054876,b1,101874630.52018389,2.153278175369664,2.1592950002564226,0.7079254132057642,5.428153491153736,5.628151134561277
Navoiy,2020,103.33204219859225,307.1403204440527,1352775.2431372548,33.972098685426715,304.1673791054876,b1,103332042.19859225,1.4574116784083628,1.430593339054731,0.47914792266495,6.885565169562099,7.139260428858973
Navoiy,2021,103.69937972340497,308.17254797549424,1357584.4862745097,34.092866903863886,304.1673791054876,b1,103699379.72340497,0.36733752481272575,0.35549236906278203,0.12076821843717056,7.252902694374825,7.520132323953854
Navoiy,2022,104.14080414335002,309.38445950830464,1363355.874509804,34.237992400636195,304.1673791054844,b1,104140804.14335002,0.44142441994505077,0.4256770109160257,0.1451254967723088,7.694327114319876,7.977820809363423
Navoiy,2023,105.87751327587593,316.54739279454935,1386080.7019607844,34.80896392875739,304.1673791054876,b1,105877513.27587593,1.7367091325259025,1.6676548129351154,0.5709715281211984,9.431036246845778,9.77851813499322
Navoiy,2024,107.2981902110347,319.78186071241237,1404669.5843137254,35.27603470384733,304.1673791054876,b1,107298190.2110347,1.4206769351587667,1.341811770226431,0.4670707750899368,10.851713182004545,11.251539212508721
Termez,2017,55.32829067909426,201.3446209483334,696241.0980392155,28.567553308008677,193.6752863731716,b1,55328290.67909426,,,,0.0,0.0
Termez,2018,58.078527871320986,218.03553994639833,730849.5058823529,29.987578156676047,193.6752863731716,b1,58078527.871320985,2.7502371922267272,4.970761175649163,1.4200248486673708,2.7502371922267272,4.970761175649163
Termez,2019,61.278041217607985,234.1389984648568,771099.3450980393,31.63957692544111,193.6752863731716,b1,61278041.21760798,3.1995133462869987,5.508943603694383,1.6519987687650612,5.949750538513726,10.753541209184391
Termez,2020,61.27637667219279,232.8871246897184,771078.568627451,31.638717473806178,193.6752863731716,b1,61276376.67219279,-0.0016645454151955619,-0.0027163815652708756,-0.0008594516349305081,5.94808599309853,10.75053272040809
Termez,2021,60.791508081612164,233.25593049126215,764984.1607843137,31.388366177231152,193.6752863731716,b1,60791508.08161216,-0.4848685905806249,-0.7912814316265782,-0.2503512965750261,5.463217402517905,9.874184319563973
Termez,2022,59.59226487889084,232.3808877258045,749895.9098039216,30.76916316729697,193.6752863731716,b1,59592264.878890835,-1.199243202721327,-1.972715006693615,-0.6192030099341821,4.2639741997965785,7.706679797009741
Termez,2023,61.33225854714227,236.01709970611012,771782.5803921568,31.667570858249768,193.6752863731716,b1,61332258.54714227,1.7399936682514294,2.919831410649709,0.8984076909527978,6.003967868048008,10.85153326509074
Termez,2024,62.322545097705515,247.64575576356089,784247.325490196,32.17888366904132,193.6752863731716,b1,62322545.09770551,0.9902865505632477,1.6146259309888,0.5113128107915514,6.994254418611256,12.641370866087541
Gulistan,2017,62.6324731121554,339.90793939814574,824497.6078431371,32.33890822367131,193.6752863731804,b1,62632473.1121554,,,,0.0,0.0
Gulistan,2018,64.28771893038663,351.8777458932324,846282.1764705882,33.19355821501912,193.6752863731804,b1,64287718.93038663,1.6552458182312293,2.642791727650917,0.8546499913478058,1.6552458182312293,2.642791727650917
Gulistan,2019,65.76801430739272,361.57450592231874,865766.6705882351,33.95787637079755,193.6752863731804,b1,65768014.30739272,1.4802953770060867,2.3026098944481266,0.7643181557784331,3.135541195237316,5.0062548059095935
Gulistan,2020,67.05769010522272,369.46389245299184,882742.7607843137,34.623772274183494,193.6752863731804,b1,67057690.105222724,1.2896757978300002,1.9609468392981944,0.6658959033859446,4.425216993067316,7.065371640591489
Gulistan,2021,67.8072093941964,370.91106863772177,892605.537254902,35.01077017309429,193.6752863731804,b1,67807209.3941964,0.749519288973687,1.11772309454381,0.38699789891079917,5.174736282041003,8.262066025677516
Gulistan,2022,69.16850490268757,382.0515968948831,910522.8470588233,35.713645348333834,193.6752863731804,b1,69168504.90268758,1.3612955084911675,2.007597010190021,0.7028751752395408,6.536031790532171,10.435532026378969
Gulistan,2023,68.7871545306522,377.89506013463927,905503.0980392154,35.51674342079488,193.6752863731804,b1,68787154.5306522,-0.3813503720353708,-0.5513352826866602,-0.19690192753895275,6.1546814184968,9.826661973694817
Gulistan,2024,70.27325564649239,393.13344579369254,925062.3098039215,36.28405924289555,193.6752863731804,b1,70273255.64649239,1.4861011158401851,2.1604340606616645,0.7673158221006702,7.640782534336985,12.19939458666226
Nurafshon,2017,46.32551550283942,694.2581945422353,614621.1450980391,23.91916716394093,193.67528637316826,b1,46325515.50283942,,,,0.0,0.0
Nurafshon,2018,47.16962238886262,712.0687172079053,625819.6470588234,24.355003300719265,193.67528637316826,b1,47169622.38886262,0.8441068860231979,1.8221208698076197,0.43583613677833455,0.8441068860231979,1.8221208698076197
Nurafshon,2019,48.15368922291314,729.4167118790581,638873.5137254901,24.863104696864585,193.67528637316826,b1,48153689.22291314,0.9840668340505161,2.0862300442813453,0.5081013961453209,1.828173720073714,3.9463645471180087
Nurafshon,2020,49.47480281419112,749.8491853869864,656398.8901960783,25.545232817606074,193.67528637316826,b1,49474802.814191125,1.3211135912779852,2.7435355682973395,0.6821281207414884,3.1492873113516993,6.798170030420203
Nurafshon,2021,49.735545173147806,750.3376326487219,659859.6470588234,25.679861434317807,193.67528637316826,b1,49735545.173147805,0.2607423589566835,0.5270205117055893,0.13462861671173343,3.4100296703083828,7.361018292606736
Nurafshon,2022,51.663195108277094,771.7297263807205,685428.1921568627,26.675161336141702,193.67528637316826,b1,51663195.1082771,1.9276499351292884,3.875799347163933,0.9952999018238948,5.337679605437671,11.52211593870016
Nurafshon,2023,51.10315227678867,769.9968613834068,678002.3058823529,26.385995463729177,193.67528637316826,b1,51103152.27678867,-0.560042831488424,-1.0840267047260044,-0.289165872412525,4.777636773949247,10.313186420249142
Nurafshon,2024,52.550409892997926,786.1467343569205,697197.9450980391,27.133255293989976,193.67528637316826,b1,52550409.89299793,1.4472576162092565,2.8320319818443185,0.7472598302607985,6.224894390158504,13.43729113986214
Fergana,2017,159.29868456910205,854.6471555814503,2094194.4156862746,36.24610000362189,439.4919303130106,b1,159298684.56910205,,,,0.0,0.0
Fergana,2018,167.75446242084467,887.2122613891268,2205327.9333333336,38.17008933505747,439.4919303130106,b1,167754462.42084467,8.455777851742624,5.3081278571855295,1.9239893314355783,8.455777851742624,5.3081278571855295
Fergana,2019,172.7072612139231,912.8312922614327,2270422.443137255,39.297026703293334,439.4919303130106,b1,172707261.2139231,4.952798793078415,2.952409564315106,1.1269373682358648,13.40857664482104,8.417255096042275
Fergana,2020,173.2154347991531,916.1838978279194,2277101.2745098043,39.412654215468145,439.4919303130106,b1,173215434.7991531,0.5081735852299971,0.29423984936021164,0.11562751217481093,13.916750230051036,8.736261864117335
Fergana,2021,174.93882876345177,926.7483065189667,2299752.5490196077,39.8047874596602,439.4919303130106,b1,174938828.76345176,1.7233939642986797,0.994942492449935,0.39213324419205264,15.640144194349716,9.81812513810507
Fergana,2022,182.00934329048061,951.5126862272284,2392708.3568627452,41.41358025865269,439.4919303130106,b1,182009343.2904806,7.070514527028848,4.0417067937441375,1.6087927989924964,22.710658721378564,14.25665176257429
Fergana,2023,179.4107536352198,928.446344070519,2358541.6078431373,40.822308957400345,439.4919303130106,b1,179410753.6352198,-2.5985896552608096,-1.4277232191940548,-0.5912713012523483,20.112069066117755,12.625383015886339
Fergana,2024,180.36249194125273,952.3582428302121,2371076.4980392163,41.03886317384639,439.4919303130106,b1,180362491.94125274,0.9517383060329223,0.53048007811618,0.2165542164460419,21.063807372150677,13.22283823568764
Urgench,2017,104.71819649776673,821.6101831669836,1400502.3098039213,34.42781957937965,304.1673791054926,b1,104718196.49776673,,,,0.0,0.0
Urgench,2018,106.50638847937671,832.473404224556,1424417.9999999995,35.01571693604846,304.1673791054926,b1,106506388.4793767,1.7881919816099838,1.7076229742441384,0.5878973566688117,1.7881919816099838,1.7076229742441384
Urgench,2019,107.94448707589835,844.2039155914922,1443645.372549019,35.48851536721343,304.1673791054793,b1,107944487.07589835,1.438098596521641,1.3502463251771069,0.4727984311649678,3.226290578131625,3.0809264158788485
Urgench,2020,109.09287621329148,857.9801005476107,1459000.4745098033,35.86606707600141,304.1673791054926,b1,109092876.21329148,1.1483891373931243,1.0638701137054563,0.3775517087879763,4.374679715524749,4.177573584948102
Urgench,2021,108.57954026796567,855.2849920268013,1452137.5137254896,35.69729948927483,304.1673791054926,b1,108579540.26796567,-0.5133359453258066,-0.47054946495512784,-0.16876758672657388,3.8613437701989426,3.6873665698408997
Urgench,2022,111.65580303475924,886.0609341111881,1493279.1568627444,36.70867118069039,304.1673791054926,b1,111655803.03475924,3.076262766793576,2.833188240806339,1.0113716914155546,6.937606536992519,6.625024846699379
Urgench,2023,113.32968390763988,898.8949341754378,1515671.1019607838,37.25898689100858,304.1673791054926,b1,113329683.90763988,1.6738808728806305,1.4991436426815552,0.5503157103181948,8.611487409873149,8.223487128196293
Urgench,2024,114.80247049742177,904.8574531300939,1535373.0196078424,37.74318956721704,304.1673791054926,b1,114802470.49742177,1.4727865897818901,1.2995594260919008,0.48420267620845436,10.08427399965504,9.629915656416133
"
# ---- Read data ----
# If reading from a file instead: df <- readr::read_csv("your_file.csv")
df <- readr::read_csv(csv_text, show_col_types = FALSE) |>
janitor::clean_names()
# Coerce numeric columns (some have blanks)
num_cols <- c("built_area_core_km2","built_area_extended_km2","built_pixels",
"urban_density_pct","analysis_area_km2","debug_area_m2",
"annual_growth_km2","annual_growth_pct","density_change_pct",
"cumulative_growth_km2","cumulative_growth_pct","year")
df <- df |>
mutate(across(all_of(num_cols), ~ suppressWarnings(as.numeric(.x))))
# ---- Basic checks & derived fields ----
df <- df |>
group_by(city) |>
arrange(year, .by_group = TRUE) |>
mutate(
# If annual growth is missing in first year, compute from difference where possible
annual_growth_km2_calc = built_area_core_km2 - lag(built_area_core_km2),
annual_growth_km2_f = coalesce(annual_growth_km2, annual_growth_km2_calc, 0),
yoy_pct_calc = (built_area_core_km2/lag(built_area_core_km2) - 1) * 100,
annual_growth_pct_f = coalesce(annual_growth_pct, yoy_pct_calc),
density_change_pct_f = coalesce(density_change_pct,
urban_density_pct - lag(urban_density_pct)),
cum_growth_km2_calc = cumsum(replace_na(annual_growth_km2_f, 0)),
cum_growth_km2_f = coalesce(cumulative_growth_km2, cum_growth_km2_calc),
cum_growth_pct_f = coalesce(cumulative_growth_pct,
cum_growth_km2_f / first(built_area_core_km2) * 100)
) |>
ungroup()
# ---- City-level summary (first/last, CAGR, ranks) ----
city_summary <- df |>
group_by(city) |>
summarise(
start_year = min(year, na.rm = TRUE),
end_year   = max(year, na.rm = TRUE),
n_years    = end_year - start_year,
core_start = built_area_core_km2[year == start_year][1],
core_end   = built_area_core_km2[year == end_year][1],
ext_start  = built_area_extended_km2[year == start_year][1],
ext_end    = built_area_extended_km2[year == end_year][1],
dens_start = urban_density_pct[year == start_year][1],
dens_end   = urban_density_pct[year == end_year][1],
delta_core_km2 = core_end - core_start,
delta_ext_km2  = ext_end - ext_start,
delta_dens_pct = dens_end - dens_start,
CAGR_core = ifelse(n_years > 0 & core_start > 0,
(core_end / core_start)^(1/n_years) - 1, NA_real_),
CAGR_ext  = ifelse(n_years > 0 & ext_start  > 0,
(ext_end  / ext_start )^(1/n_years) - 1, NA_real_)
) |>
mutate(
rank_delta_core = dense_rank(desc(delta_core_km2)),
rank_cagr_core  = dense_rank(desc(CAGR_core))
) |>
arrange(rank_delta_core)
readr::write_csv(city_summary, file.path(out_dir, "city_summary_2017_2024.csv"))
# ---- Anomaly flags ----
anomalies <- df |>
mutate(
flag_neg_growth = annual_growth_km2_f < 0,
flag_density_drop_gt1 = density_change_pct_f < -1,
flag_missing_any = if_any(everything(), ~ is.na(.x))
) |>
filter(flag_neg_growth | flag_density_drop_gt1 | flag_missing_any)
readr::write_csv(anomalies, file.path(out_dir, "anomalies.csv"))
# ---- Correlations (wide numeric) ----
num_mat <- df |>
select(where(is.numeric)) |>
select(-year) |> # keep year out of corr
drop_na()
if (nrow(num_mat) > 2) {
corr_m <- cor(num_mat, use = "pairwise.complete.obs")
png(file.path(out_dir, "correlation_matrix.png"), width = 1400, height = 1200, res = 150)
corrplot::corrplot(corr_m, method = "color", tl.cex = 0.7, number.cex = 0.6, addCoef.col = NA)
dev.off()
}
# ---- Helper for saving ggplots ----
save_plot <- function(p, filename, w = 10, h = 6) {
ggsave(file.path(out_dir, filename), p, width = w, height = h, dpi = 150)
}
theme_set(
theme_minimal(base_size = 12) +
theme(
plot.title = element_text(face = "bold", size = 14),
plot.subtitle = element_text(color = "grey30"),
plot.caption = element_text(size = 9, color = "grey40"),
panel.grid.minor = element_blank()
)
)
# ---- 1) Core built-up area over time (faceted) ----
p1 <- df |>
ggplot(aes(year, built_area_core_km2, group = city)) +
geom_line() +
geom_point(size = 1.7) +
facet_wrap(~ fct_reorder(city, built_area_core_km2, .fun = max, .desc = TRUE), scales = "free_y") +
labs(
title = "Built-up Area (Core) Over Time",
y = "Built Area (km²)", x = NULL,
caption = "Source: SUHI/urban classification outputs (2017–2024)"
)
save_plot(p1, "01_core_built_area_timeseries.png", w = 12, h = 9)
# ---- 2) Annual growth % heatmap ----
p2 <- df |>
mutate(year = factor(year)) |>
ggplot(aes(
year,
fct_reorder(city, built_area_core_km2, .fun = max, .desc = TRUE),
fill = annual_growth_pct_f
)) +
geom_tile(color = "white", linewidth = 0.2) +
scale_fill_viridis_c(labels = label_percent(scale = 1), na.value = "grey90") +
labs(
title = "Annual Growth Rate of Built-up Area — Heatmap",
x = NULL, y = NULL, fill = "YoY growth",
caption = "White borders help read across years. NA shown in light grey."
)
save_plot(p2, "02_growth_pct_heatmap.png", w = 10, h = 6.5)
# ---- 3) CAGR by city (core) ----
p3 <- city_summary |>
mutate(city = fct_reorder(city, CAGR_core)) |>
ggplot(aes(CAGR_core, city)) +
geom_col() +
scale_x_continuous(labels = label_percent(accuracy = 0.1)) +
labs(
title = "CAGR of Core Built-up Area (2017–2024)",
x = "CAGR", y = NULL
)
save_plot(p3, "03_cagr_core.png", w = 9, h = 6)
# ---- 4) Slope chart: 2017 vs 2024 (core) ----
ends <- df |>
filter(year %in% c(2017, 2024)) |>
select(city, year, built_area_core_km2) |>
pivot_wider(names_from = year, values_from = built_area_core_km2, names_prefix = "y") |>
drop_na() |>
mutate(city = fct_reorder(city, y2024))
p4 <- ggplot(ends) +
geom_segment(aes(x = 2017, xend = 2024, y = city, yend = city)) +
geom_point(aes(x = 2017, y = city, size = y2017)) +
geom_point(aes(x = 2024, y = city, size = y2024)) +
scale_x_continuous(breaks = c(2017, 2024)) +
guides(size = "none") +
labs(
title = "Core Built-up Area: Start vs End (2017 → 2024)",
x = NULL, y = NULL,
caption = "Point size ~ built area (km²)"
)
save_plot(p4, "04_slope_2017_2024.png", w = 9.5, h = 7)
# ---- 5) Density vs Core Built-up Area (all years) ----
p5 <- df |>
ggplot(aes(built_area_core_km2, urban_density_pct, color = city)) +
geom_path(alpha = 0.6) +
geom_point(aes(size = built_area_core_km2)) +
scale_y_continuous(labels = label_percent(scale = 1)) +
labs(
title = "Urban Density vs Core Built-up Area",
x = "Core Built Area (km²)", y = "Urban Density (%)",
caption = "Trajectories across years 2017–2024"
)
save_plot(p5, "05_density_vs_area.png", w = 10, h = 7)
# ---- 6) Extended vs Core built area (relationship) ----
p6 <- df |>
ggplot(aes(built_area_core_km2, built_area_extended_km2, color = city)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE, linewidth = 0.5, alpha = 0.6) +
labs(
title = "Relationship: Extended vs Core Built-up Area",
x = "Core (km²)", y = "Extended (km²)"
)
save_plot(p6, "06_extended_vs_core.png", w = 9, h = 6.5)
# ---- 7) Top growth years per city (bar small multiples) ----
top_growth <- df |>
group_by(city) |>
slice_max(order_by = annual_growth_km2_f, n = 1, with_ties = FALSE) |>
ungroup() |>
arrange(desc(annual_growth_km2_f))
readr::write_csv(top_growth, file.path(out_dir, "top_growth_year_per_city.csv"))
p7 <- top_growth |>
mutate(city = fct_reorder(city, annual_growth_km2_f)) |>
ggplot(aes(annual_growth_km2_f, city, fill = city)) +
geom_col(show.legend = FALSE) +
labs(
title = "Peak Annual Growth in Core Built-up Area (by City, 2017–2024)",
x = "Annual Growth (km²)", y = NULL
)
save_plot(p7, "07_top_growth_by_city.png", w = 9, h = 6)
# ---- 8) Cumulative growth trajectories ----
p8 <- df |>
ggplot(aes(year, cum_growth_km2_f, color = city)) +
geom_line() + geom_point(size = 1.3) +
labs(
title = "Cumulative Growth of Core Built-up Area",
x = NULL, y = "Cumulative Growth (km²)"
)
save_plot(p8, "08_cumulative_growth.png", w = 10, h = 6.5)
# ---- 9) City summary table (nice print) ----
message("\n===== City Summary (2017–2024) =====")
city_summary_pretty <- city_summary |>
transmute(
city,
period = glue("{start_year}–{end_year}"),
`Δ Core (km²)` = round(delta_core_km2, 2),
`Δ Ext (km²)`  = round(delta_ext_km2, 2),
`Δ Density (pp)` = round(delta_dens_pct, 2),
`CAGR Core` = scales::percent(CAGR_core, accuracy = 0.01),
`CAGR Ext`  = scales::percent(CAGR_ext,  accuracy = 0.01),
`Rank Δ Core` = rank_delta_core,
`Rank CAGR`   = rank_cagr_core
)
print(city_summary_pretty, n = nrow(city_summary_pretty))
# Save also as CSV
readr::write_csv(city_summary_pretty, file.path(out_dir, "city_summary_pretty.csv"))
# ---- 10) Anomalies quick view ----
if (nrow(anomalies)) {
message("\n===== Anomalies Detected =====")
anomalies_view <- anomalies |>
transmute(
city, year,
annual_growth_km2_f = round(annual_growth_km2_f, 3),
density_change_pct_f = round(density_change_pct_f, 3),
neg_growth = flag_neg_growth,
density_drop_gt1pp = flag_density_drop_gt1,
any_missing = flag_missing_any
)
print(anomalies_view, n = nrow(anomalies_view))
}
# ---- Done ----
message(glue("\nAll artifacts saved to: {out_dir}\n",
"Files include plots (PNG), correlation matrix, and CSV summaries."))
