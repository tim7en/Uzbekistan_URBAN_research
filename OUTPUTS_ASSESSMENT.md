# Local Outputs Assessment Report

## Overview
This document provides a comprehensive catalog of all local outputs generated by the Uzbekistan Urban Research unit tests. Each unit generates specific file types with documented spatial and temporal resolutions.

---

## Output Directory Structure
```
suhi_analysis_output/
├── reports/                    # Summary JSONs and batch reports
├── nightlights/               # VIIRS nightlight outputs
│   └── <city>/               # Per-city subdirectories
├── nightlights_analysis/     # Nightlight analysis results
├── lulc/                     # Land Use/Land Cover coarse outputs
│   └── <city>/               # Per-city LULC GeoTIFFs
├── lulc_highres/             # High-resolution LULC outputs
│   └── <city>/               # Per-city high-res GeoTIFFs
├── lulc_analysis/            # LULC temporal analysis
│   └── <city>/               # Per-city analysis JSONs and plots
├── suhi/                     # Surface Urban Heat Island outputs
│   └── <city>/               # Per-city SUHI analysis JSONs
├── vegetation/               # Vegetation indices outputs
│   └── <city>/               # Per-city vegetation GeoTIFFs and JSONs
└── temperature/              # Land Surface Temperature outputs
    └── <city>/               # Per-city LST GeoTIFFs
```

---

## Unit Test 1: Nightlights Analysis

### Purpose
Analyzes nighttime light intensity using VIIRS Monthly DNB data to assess urban illumination patterns and temporal changes.

### Dataset
- **Source**: NOAA VIIRS DNB Monthly (VIIRS/DNB/MONTHLY_V1/VCMCFG)
- **Native Resolution**: ~500-750m (sensor dependent)
- **Temporal Coverage**: 2016-2024 (annual composites)

### Outputs Generated

#### 1. Thumbnail Images (PNG)
- **Location**: `suhi_analysis_output/nightlights/<city>/`
- **Filename Pattern**: `viirs_<year>.png`
- **Format**: PNG (1024px, not georeferenced)
- **Purpose**: Visual preview of nightlight distribution
- **Spatial Resolution**: Variable (fitted to city extent)
- **Temporal Resolution**: Annual

#### 2. Per-City Analysis JSONs
- **Location**: `suhi_analysis_output/nightlights/<city>/`
- **Filename Pattern**: `<city>_nightlights.json`
- **Content**: 
  - Zonal statistics (mean, stdDev, count) for urban core and rural ring
  - Uncertainty metrics (standard error, 95% confidence intervals)
  - Thumbnail file paths
- **Spatial Resolution**: Statistics computed at 100m (ANALYSIS_CONFIG['target_resolution_m'])
- **Temporal Resolution**: Annual (2016-2024)

#### 3. Aggregate Summary
- **Location**: `suhi_analysis_output/nightlights_summary.json`
- **Content**: Compilation of all per-city results
- **Purpose**: Batch processing summary

#### 4. Optional GeoTIFF Downloads
- **Location**: `suhi_analysis_output/nightlights/<city>/`
- **Filename Pattern**: `<city>_viirs_<year>_coarse.tif`
- **Format**: GeoTIFF (georeferenced)
- **Spatial Resolution**: Configurable (default 500m+ for local downloads)
- **Temporal Resolution**: Annual composites

---

## Unit Test 2: LULC (Land Use/Land Cover) Analysis

### Purpose
Generates land cover classifications and uncertainty assessments using ESRI Global LULC dataset.

### Dataset
- **Source**: ESRI Global LULC Time Series (projects/sat-io/open-datasets/landcover/ESRI_Global-LULC_10m_TS)
- **Native Resolution**: ~10m
- **Temporal Coverage**: Annual maps (2017-2024)

### Outputs Generated

#### 1. Coarse Resolution GeoTIFFs
- **Location**: `suhi_analysis_output/lulc/<city>/`
- **Filename Patterns**:
  - `esri_full_<year>_coarse.tif` - Full classification map
  - `esri_built_<year>_coarse.tif` - Built-up areas mask (class 7)
- **Format**: GeoTIFF (Int16 for full, Byte for built mask)
- **Spatial Resolution**: 200m (enforced minimum for coarse outputs)
- **Temporal Resolution**: Annual
- **Purpose**: Local analysis with manageable file sizes

#### 2. High-Resolution GeoTIFFs
- **Location**: `suhi_analysis_output/lulc_highres/<city>/`
- **Filename Patterns**: Same as coarse, with `_highres.tif` suffix
- **Spatial Resolution**: 30m
- **Purpose**: Detailed analysis and Drive exports
- **Note**: Generated only when `--save-highres` flag is used

#### 3. Generation Summary JSONs
- **Location**: `suhi_analysis_output/lulc_summary.json`
- **Content**:
  - File paths for generated GeoTIFFs
  - Categorical uncertainty metrics (histogram, proportions, Shannon entropy)
  - Processing status per city/year
- **Uncertainty Metrics**:
  - **Histogram**: Class frequency counts
  - **Proportions**: Normalized class frequencies
  - **Entropy**: Shannon entropy in nats (uncertainty measure)

#### 4. Temporal Analysis Results
- **Location**: `suhi_analysis_output/lulc_analysis/<city>/`
- **Filename Pattern**: `<city>_lulc_analysis_<start_year>_<end_year>.json`
- **Content**:
  - Per-class area calculations (m²)
  - Built-up area time series
  - ESRI class mapping and percentages
- **Spatial Resolution**: Based on input GeoTIFF resolution
- **Temporal Resolution**: Multi-year trend analysis

---

## Unit Test 3: SUHI (Surface Urban Heat Island) Analysis

### Purpose
Quantifies urban heat island effects using Landsat thermal data and MODIS LST for day/night comparisons.

### Datasets
- **Primary**: Landsat 8/9 thermal bands (LANDSAT/LC08|09/C02/T1_L2)
- **Secondary**: MODIS LST (MODIS/061/MOD11A2)
- **Native Resolution**: 
  - Landsat thermal: ~100m (resampled to 30m in some products)
  - MODIS LST: ~1km
- **Temporal Coverage**: Annual or seasonal composites

### Outputs Generated

#### 1. Per-City SUHI Analysis JSONs
- **Location**: `suhi_analysis_output/suhi/<city>/`
- **Filename Pattern**: `<city>_suhi_<year>.json`
- **Content**:
  - Urban vs rural mean temperatures
  - SUHI intensity (urban - rural temperature difference)
  - Zonal uncertainty metrics (mean, stdDev, count, stdError, 95% CI)
  - Day/night SUHI comparisons (when MODIS data available)
- **Spatial Resolution**: Statistics computed at 100-250m (adaptive based on processing constraints)
- **Temporal Resolution**: Annual

#### 2. Optional SUHI Map Exports
- **Location**: Via Drive export (asynchronous)
- **Format**: GeoTIFF tiles for large cities
- **Spatial Resolution**: 30m (configurable)
- **Purpose**: Detailed spatial SUHI mapping
- **Note**: Generated via `export_suhi_tiles()` function

---

## Unit Test 4: Auxiliary Data Analysis (Vegetation/Biodiversity)

### Purpose
Generates seasonal vegetation indices (NDVI, EVI) and land surface temperature composites with biomass estimates.

### Datasets
- **Source**: Landsat 8/9 Surface Reflectance (LANDSAT/LC08|09/C02/T1_L2)
- **Native Resolution**: 30m (optical bands), ~100m (thermal)
- **Temporal Coverage**: Seasonal composites per year

### Outputs Generated

#### 1. Vegetation Index GeoTIFFs
- **Location**: `suhi_analysis_output/vegetation/<city>/`
- **Filename Patterns**:
  - `<city>_ndvi_evi_summer_<year>.tif` - Summer NDVI/EVI composite
  - `<city>_ndvi_evi_winter_<year>.tif` - Winter NDVI/EVI composite
  - `<city>_ndvi_change_<year>.tif` - Seasonal NDVI difference
  - `<city>_evi_change_<year>.tif` - Seasonal EVI difference
- **Format**: GeoTIFF (Float32, 2-band: NDVI and EVI)
- **Spatial Resolution**: 30m (default)
- **Temporal Resolution**: 
  - Summer: June-August composite (ANALYSIS_CONFIG['warm_months'])
  - Winter: January-February composite

#### 2. Land Surface Temperature GeoTIFFs
- **Location**: `suhi_analysis_output/temperature/<city>/`
- **Filename Patterns**:
  - `<city>_lst_summer_<year>.tif` - Summer LST composite
  - `<city>_lst_winter_<year>.tif` - Winter LST composite
  - `<city>_lst_change_<year>.tif` - Seasonal LST difference
- **Format**: GeoTIFF (Float32)
- **Spatial Resolution**: 30m (resampled from thermal bands)
- **Units**: Celsius

#### 3. Per-City Analysis JSONs
- **Location**: `suhi_analysis_output/vegetation/<city>/`
- **Filename Pattern**: `<city>_auxiliary_<year>.json`
- **Content**:
  - Regional mean values for all indices
  - Biomass estimates (t/ha) using NDVI-to-biomass conversion
  - Uncertainty metrics for each indicator (mean, stdDev, count, stdError, 95% CI)
  - File paths to generated GeoTIFFs
- **Biomass Model**: Fractional vegetation cover scaling (configurable presets)

#### 4. Batch Summary
- **Location**: `suhi_analysis_output/reports/auxiliary_batch_results.json`
- **Content**: Compilation of all per-city auxiliary results

---

## Smoke Test Outputs

### Purpose
Quick verification runs with subset of cities and years for testing and validation.

### Generated Files
1. **smoke_nightlight.json** - Nightlight smoke test results
2. **smoke_lulc.json** - LULC smoke test results (ESRI-only)
3. **smoke_suhi.json** - SUHI smoke test results
4. **smoke_auxiliary.json** - Auxiliary data smoke test results
5. **smoke_runs_index.json** - Master index of all smoke test outputs

### Coverage
- **Cities**: Tashkent, Nukus (representative sample)
- **Years**: 2018, 2019 (recent years for quick testing)
- **Purpose**: Rapid validation of all processing pipelines

---

## Spatial Resolution Summary Table

| Unit | Dataset | Native Resolution | Coarse Output | High-Res Output | Analysis Stats |
|------|---------|------------------|---------------|-----------------|----------------|
| Nightlights | VIIRS Monthly | ~500-750m | 500m+ (configurable) | N/A | 100m |
| LULC | ESRI LULC | ~10m | 200m (enforced min) | 30m | 200m / 30m |
| SUHI | Landsat Thermal | ~100m | 100-250m (adaptive) | 30m (Drive) | 100-250m |
| SUHI | MODIS LST | ~1km | 1km | N/A | 1km |
| Auxiliary | Landsat SR | 30m | 30m (default) | N/A | 30m |

---

## Temporal Resolution Summary

| Unit | Aggregation Type | Window | Coverage |
|------|-----------------|--------|----------|
| Nightlights | Annual median | Jan 1 - Dec 31 | 2016-2024 |
| LULC | Annual maps | Per-year | 2017-2024 |
| SUHI | Annual/seasonal | Jan 1 - Dec 31 | 2017-2024 |
| Auxiliary | Seasonal median | Summer: Jun-Aug, Winter: Jan-Feb | 2016-2024 |

---

## File Size Expectations

### Small Files (< 10 MB)
- Thumbnail PNGs
- Analysis JSONs
- Summary reports

### Medium Files (10-100 MB)
- Coarse GeoTIFFs (200m resolution)
- Single-band derivatives

### Large Files (> 100 MB)
- High-resolution GeoTIFFs (30m resolution)
- Multi-band vegetation composites
- Full-extent SUHI maps

---

## Configuration Parameters

### Key Variables for Spatial Resolution
- `ANALYSIS_CONFIG['target_resolution_m']` = 100 (nightlight stats)
- `run_lulc_unit.py --coarse-scale` = 200 (LULC coarse)
- `run_lulc_unit.py --highres-scale` = 30 (LULC high-res)
- `suhi_unit.run_batch(download_scale=...)` (SUHI resolution)
- `auxiliary_data.run_batch(download_scale=...)` (vegetation resolution)

### Key Variables for Temporal Windows
- `ANALYSIS_CONFIG['warm_months']` = [6,7,8] (summer months)
- `ANALYSIS_CONFIG['years']` = [2016-2023] (default year range)

---

## Uncertainty Quantification

### Continuous Data (VIIRS, LST, NDVI/EVI)
- **Zonal Statistics**: Mean, standard deviation, pixel count
- **Uncertainty Metrics**: Standard error, 95% confidence intervals
- **Method**: Earth Engine server-side reducers over analysis zones

### Categorical Data (LULC)
- **Frequency Analysis**: Class histograms, proportions
- **Uncertainty Metric**: Shannon entropy (nats)
- **Interpretation**: Higher entropy = more mixed/uncertain classification

---

## Quality Assurance Notes

### Common Issues
1. **Memory Limits**: Large regions may hit EE memory limits
   - **Solution**: Automatic tileScale retries implemented
   - **Fallback**: Coarser analysis resolution

2. **Missing Data**: Some years/regions may lack coverage
   - **Handling**: Graceful fallbacks to available data
   - **Reporting**: Null values in JSON outputs

3. **Projection Accuracy**: Area calculations assume square pixels
   - **Limitation**: Less accurate for very large extents
   - **Mitigation**: Appropriate for city-scale analysis

### Validation Recommendations
1. Spot-check GeoTIFF pixel sizes using verification scripts
2. Compare zonal statistics across different resolutions
3. Validate temporal trends against known urban development patterns
4. Cross-reference uncertainty metrics with visual inspection

---

## Usage Examples

### Running Full Analysis
```bash
# All units for selected cities and years
python main.py --unit all --start-year 2018 --end-year 2022 --cities Tashkent Nukus

# Individual units
python main.py --unit lulc --save-local --save-highres
python main.py --unit suhi --start-year 2020 --end-year 2020
```

### Quick Smoke Tests
```bash
# Run all smoke tests
python run_smoke.py

# Results in suhi_analysis_output/reports/smoke_*.json
```

### Custom Resolution
```bash
# High-resolution LULC
python run_lulc_unit.py --generate --save-highres --highres-scale 10

# Coarse SUHI for fast processing
python -c "from services.suhi_unit import run_batch; run_batch(['Tashkent'], [2020], download_scale=500)"
```

---

*Last Updated: August 22, 2025*
*Generated from codebase analysis and output inspection*
